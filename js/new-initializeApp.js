// u041du043eu0432u0430u044f u0444u0443u043du043au0446u0438u044f u0434u043bu044f u0438u043du0438u0446u0438u0430u043bu0438u0437u0430u0446u0438u0438 u043fu0440u0438u043bu043eu0436u0435u043du0438u044f
async function initializeApp() {
  try {
    console.log('u041du0430u0447u0430u043bu043e u0438u043du0438u0446u0438u0430u043bu0438u0437u0430u0446u0438u0438 u043fu0440u0438u043bu043eu0436u0435u043du0438u044f...');
    
    // u041fu043eu043bu0443u0447u0430u0435u043c ID u043fu043eu043bu044cu0437u043eu0432u0430u0442u0435u043bu044f
    const telegramId = await getTelegramUserId();
    console.log('u041fu043eu043bu0443u0447u0435u043d Telegram ID:', telegramId);
    
    // u041fu043eu043bu0443u0447u0430u0435u043c u0434u0430u043du043du044bu0435 u043fu043eu043bu044cu0437u043eu0432u0430u0442u0435u043bu044f u0438u0437 u0431u0430u0437u044b u0434u0430u043du043du044bu0445 u0438u043bu0438 u0441u043eu0437u0434u0430u0435u043c u043du043eu0432u043eu0433u043e u043fu043eu043bu044cu0437u043eu0432u0430u0442u0435u043bu044f
    console.log('u0417u0430u043fu0440u0430u0448u0438u0432u0430u0435u043c u0434u0430u043du043du044bu0435 u043fu043eu043bu044cu0437u043eu0432u0430u0442u0435u043bu044f u0438u0437 u0431u0430u0437u044b u0434u0430u043du043du044bu0445...');
    const user = await getUser(telegramId);
    console.log('u041fu043eu043bu0443u0447u0435u043du044b u0434u0430u043du043du044bu0435 u043fu043eu043bu044cu0437u043eu0432u0430u0442u0435u043bu044f:', user);
    
    // u041fu0440u043eu0432u0435u0440u044fu0435u043c, u0447u0442u043e u0434u0430u043du043du044bu0435 u043fu043eu043bu044cu0437u043eu0432u0430u0442u0435u043bu044f u0441u043eu0434u0435u0440u0436u0430u0442 u043fu0440u0430u0432u0438u043bu044cu043du044bu0439 Telegram ID
    if (user.telegram_id !== String(telegramId)) {
      console.warn('u041du0435u0441u043eu043eu0442u0432u0435u0442u0441u0442u0432u0438u0435 Telegram ID! u0412 u0431u0430u0437u0435:', user.telegram_id, 'u0422u0435u043au0443u0449u0438u0439:', telegramId);
      // u041eu0431u043du043eu0432u043bu044fu0435u043c Telegram ID u0432 u0431u0430u0437u0435 u0434u0430u043du043du044bu0445
      await updateUser(telegramId, { telegram_id: String(telegramId) });
      console.log('Telegram ID u043eu0431u043du043eu0432u043bu0435u043d u0432 u0431u0430u0437u0435 u0434u0430u043du043du044bu0445');
      // u041fu043eu043bu0443u0447u0430u0435u043c u043eu0431u043du043eu0432u043bu0435u043du043du044bu0435 u0434u0430u043du043du044bu0435 u043fu043eu043bu044cu0437u043eu0432u0430u0442u0435u043bu044f
      user = await getUser(telegramId);
    }
    
    // u0412u044bu0432u043eu0434u0438u043c u043fu043eu0434u0440u043eu0431u043du0443u044e u0438u043du0444u043eu0440u043cu0430u0446u0438u044e u043e u043fu043eu043bu044cu0437u043eu0432u0430u0442u0435u043bu0435
    logUserInfo(user, telegramId);
    
    // u0421u043eu0445u0440u0430u043du044fu0435u043c u0434u0430u043du043du044bu0435 u043fu043eu043bu044cu0437u043eu0432u0430u0442u0435u043bu044f u0432 u0433u043bu043eu0431u0430u043bu044cu043du0443u044e u043fu0435u0440u0435u043cu0435u043du043du0443u044e
    currentUser = user;
    
    // u0413u0435u043du0435u0440u0438u0440u0443u0435u043c u0440u0435u0444u0435u0440u0430u043bu044cu043du044bu0439 u043au043eu0434, u0435u0441u043bu0438 u043du0435 u0441u0443u0449u0435u0441u0442u0432u0443u0435u0442
    await generateReferralCode();
    
    // u041fu043eu043bu0443u0447u0430u0435u043c u0438u043cu044f u043fu043eu043bu044cu0437u043eu0432u0430u0442u0435u043bu044f u0441 u043fu043eu043cu043eu0449u044cu044e u043eu0431u043du043eu0432u043bu0435u043du043du043eu0439 u0444u0443u043du043au0446u0438u0438
    const userName = await getTelegramUserName();
    console.log('u0418u043cu044f u043fu043eu043bu044cu0437u043eu0432u0430u0442u0435u043bu044f u0434u043bu044f u043eu0441u043du043eu0432u043du043eu0433u043e u0438u043du0442u0435u0440u0444u0435u0439u0441u0430:', userName);
    
    // u041eu0431u043du043eu0432u043bu044fu0435u043c UI u0441 u0434u0430u043du043du044bu043cu0438 u0438u0437 u0431u0430u0437u044b
    const totalXp = document.getElementById('xp-amount');
    const streakCount = document.getElementById('streak-count');
    const checkinStreak = document.getElementById('checkin-streak');
    
    // u041eu0431u043du043eu0432u043bu044fu0435u043c u0438u043cu044f u043fu043eu043bu044cu0437u043eu0432u0430u0442u0435u043bu044f u0432 u043eu0441u043du043eu0432u043du043eu043c u0438u043du0442u0435u0440u0444u0435u0439u0441u0435
    const userNameElement = document.getElementById('user-name');
    if (userNameElement) {
      userNameElement.textContent = userName;
      console.log('u0418u043cu044f u043fu043eu043bu044cu0437u043eu0432u0430u0442u0435u043bu044f u043eu0431u043du043eu0432u043bu0435u043du043e u0432 u043eu0441u043du043eu0432u043du043eu043c u0438u043du0442u0435u0440u0444u0435u0439u0441u0435:', userName);
    }
    
    // u041eu0431u043du043eu0432u043bu044fu0435u043c u0438u043cu044f u043fu043eu043bu044cu0437u043eu0432u0430u0442u0435u043bu044f u0432 u043cu043eu0434u0430u043bu044cu043du043eu043c u043eu043au043du0435 u043fu0440u043eu0444u0438u043bu044f
    const userNameModal = document.getElementById('user-name-modal');
    if (userNameModal) {
      userNameModal.textContent = userName;
      console.log('u0418u043cu044f u043fu043eu043bu044cu0437u043eu0432u0430u0442u0435u043bu044f u043eu0431u043du043eu0432u043bu0435u043du043e u0432 u043cu043eu0434u0430u043bu044cu043du043eu043c u043eu043au043du0435:', userName);
    }
    
    if (totalXp) {
      totalXp.textContent = (user.points || 0).toString();
    }
    
    if (streakCount) {
      streakCount.textContent = (user.current_streak || 0).toString();
    }
    
    if (checkinStreak) {
      checkinStreak.textContent = (user.current_streak || 0).toString();
    }
    
    // u041eu0431u043du043eu0432u043bu044fu0435u043c u0441u0442u0430u0442u0443u0441 u043au043du043eu043fu043au0438 u0447u0435u043au0438u043du0430
    await updateCheckinButton();
    
    console.log('u041fu0440u0438u043bu043eu0436u0435u043du0438u0435 u0443u0441u043fu0435u0448u043du043e u0438u043du0438u0446u0438u0430u043bu0438u0437u0438u0440u043eu0432u0430u043du043e');
    return true;
  } catch (error) {
    console.error('u041eu0448u0438u0431u043au0430 u043fu0440u0438 u0438u043du0438u0446u0438u0430u043bu0438u0437u0430u0446u0438u0438 u043fu0440u0438u043bu043eu0436u0435u043du0438u044f:', error);
    return false;
  }
}
