/**
 * u0421u043au0440u0438u043fu0442 u0434u043bu044f u043eu043fu0442u0438u043cu0438u0437u0430u0446u0438u0438 u0438 u0441u0436u0430u0442u0438u044f u0432u0438u0434u0435u043e
 */

document.addEventListener('DOMContentLoaded', function() {
  // u041fu0440u043eu0432u0435u0440u044fu0435u043c, u0435u0441u0442u044c u043bu0438 u0443u0436u0435 u043eu043fu0442u0438u043cu0438u0437u0438u0440u043eu0432u0430u043du043du0430u044f u0432u0435u0440u0441u0438u044f u0432 localStorage
  const optimizedVideoKey = 'optimized_style1_video';
  const optimizedVideo = localStorage.getItem(optimizedVideoKey);
  
  if (optimizedVideo) {
    console.log('u041du0430u0439u0434u0435u043du0430 u043eu043fu0442u0438u043cu0438u0437u0438u0440u043eu0432u0430u043du043du0430u044f u0432u0435u0440u0441u0438u044f u0432u0438u0434u0435u043e u0432 localStorage');
    applyOptimizedVideo(optimizedVideo);
  } else {
    console.log('u041eu043fu0442u0438u043cu0438u0437u0438u0440u043eu0432u0430u043du043du0430u044f u0432u0435u0440u0441u0438u044f u0432u0438u0434u0435u043e u043du0435 u043du0430u0439u0434u0435u043du0430, u0438u0441u043fu043eu043bu044cu0437u0443u0435u043c u043eu0440u0438u0433u0438u043du0430u043b');
    // u0414u043eu0431u0430u0432u043bu044fu0435u043c u0434u043eu043fu043eu043bu043du0438u0442u0435u043bu044cu043du044bu0435 u0430u0442u0440u0438u0431u0443u0442u044b u0434u043bu044f u043eu043fu0442u0438u043cu0438u0437u0430u0446u0438u0438
    optimizeVideoLoading();
  }
});

/**
 * u041fu0440u0438u043cu0435u043du044fu0435u0442 u043eu043fu0442u0438u043cu0438u0437u0438u0440u043eu0432u0430u043du043du0443u044e u0432u0435u0440u0441u0438u044e u0432u0438u0434u0435u043e
 * @param {string} dataUrl - Data URL u0441 u043eu043fu0442u0438u043cu0438u0437u0438u0440u043eu0432u0430u043du043du044bu043c u0432u0438u0434u0435u043e
 */
function applyOptimizedVideo(dataUrl) {
  const video = document.getElementById('start-bg');
  if (!video) return;
  
  // u0421u043eu0437u0434u0430u0435u043c u043du043eu0432u044bu0439 source u044du043bu0435u043cu0435u043du0442 u0441 u043eu043fu0442u0438u043cu0438u0437u0438u0440u043eu0432u0430u043du043du044bu043c u0432u0438u0434u0435u043e
  const source = document.createElement('source');
  source.src = dataUrl;
  source.type = 'video/mp4';
  
  // u0423u0434u0430u043bu044fu0435u043c u0441u0443u0449u0435u0441u0442u0432u0443u044eu0449u0438u0435 source u044du043bu0435u043cu0435u043du0442u044b
  while (video.firstChild) {
    video.removeChild(video.firstChild);
  }
  
  // u0414u043eu0431u0430u0432u043bu044fu0435u043c u043du043eu0432u044bu0439 source u044du043bu0435u043cu0435u043du0442
  video.appendChild(source);
  
  // u0417u0430u0433u0440u0443u0436u0430u0435u043c u0438 u0432u043eu0441u043fu0440u043eu0438u0437u0432u043eu0434u0438u043c u0432u0438u0434u0435u043e
  video.load();
  video.play().catch(e => console.error('u041eu0448u0438u0431u043au0430 u043fu0440u0438 u0432u043eu0441u043fu0440u043eu0438u0437u0432u0435u0434u0435u043du0438u0438 u0432u0438u0434u0435u043e:', e));
}

/**
 * u041eu043fu0442u0438u043cu0438u0437u0438u0440u0443u0435u0442 u0437u0430u0433u0440u0443u0437u043au0443 u0432u0438u0434u0435u043e
 */
function optimizeVideoLoading() {
  const video = document.getElementById('start-bg');
  if (!video) return;
  
  // u0414u043eu0431u0430u0432u043bu044fu0435u043c u0434u043eu043fu043eu043bu043du0438u0442u0435u043bu044cu043du044bu0435 u0430u0442u0440u0438u0431u0443u0442u044b u0434u043bu044f u043eu043fu0442u0438u043cu0438u0437u0430u0446u0438u0438
  video.setAttribute('playsinline', '');
  video.setAttribute('muted', '');
  video.setAttribute('disablePictureInPicture', '');
  video.setAttribute('disableRemotePlayback', '');
  
  // u0414u043eu0431u0430u0432u043bu044fu0435u043c u043eu0431u0440u0430u0431u043eu0442u0447u0438u043a u0434u043bu044f u043fu0440u0435u0434u0437u0430u0433u0440u0443u0437u043au0438 u0432u0438u0434u0435u043e
  video.addEventListener('canplaythrough', function onCanPlay() {
    console.log('u0412u0438u0434u0435u043e u0433u043eu0442u043eu0432u043e u043a u0432u043eu0441u043fu0440u043eu0438u0437u0432u0435u0434u0435u043du0438u044e');
    
    // u0423u0434u0430u043bu044fu0435u043c u043eu0431u0440u0430u0431u043eu0442u0447u0438u043a u043fu043eu0441u043bu0435 u043fu0435u0440u0432u043eu0433u043e u0441u0440u0430u0431u0430u0442u044bu0432u0430u043du0438u044f
    video.removeEventListener('canplaythrough', onCanPlay);
    
    // u0412u043eu0441u043fu0440u043eu0438u0437u0432u043eu0434u0438u043c u0432u0438u0434u0435u043e
    video.play().catch(e => console.error('u041eu0448u0438u0431u043au0430 u043fu0440u0438 u0432u043eu0441u043fu0440u043eu0438u0437u0432u0435u0434u0435u043du0438u0438 u0432u0438u0434u0435u043e:', e));
  });
  
  // u0414u043eu0431u0430u0432u043bu044fu0435u043c u043eu0431u0440u0430u0431u043eu0442u0447u0438u043a u0434u043bu044f u043eu0448u0438u0431u043eu043a u0437u0430u0433u0440u0443u0437u043au0438
  video.addEventListener('error', function(e) {
    console.error('u041eu0448u0438u0431u043au0430 u043fu0440u0438 u0437u0430u0433u0440u0443u0437u043au0435 u0432u0438u0434u0435u043e:', e);
  });
  
  // u0414u043eu0431u0430u0432u043bu044fu0435u043c u043eu0431u0440u0430u0431u043eu0442u0447u0438u043a u0434u043bu044f u043eu0442u0441u043bu0435u0436u0438u0432u0430u043du0438u044f u043fu0440u043eu0433u0440u0435u0441u0441u0430 u0437u0430u0433u0440u0443u0437u043au0438
  video.addEventListener('progress', function() {
    if (video.buffered.length > 0) {
      const loadedPercentage = (video.buffered.end(0) / video.duration) * 100;
      console.log(`u0417u0430u0433u0440u0443u0436u0435u043du043e ${loadedPercentage.toFixed(2)}% u0432u0438u0434u0435u043e`);
    }
  });
  
  // u0417u0430u0433u0440u0443u0436u0430u0435u043c u0432u0438u0434u0435u043e
  video.load();
}

/**
 * u0421u043eu0437u0434u0430u0435u0442 u043eu043fu0442u0438u043cu0438u0437u0438u0440u043eu0432u0430u043du043du0443u044e u0432u0435u0440u0441u0438u044e u0432u0438u0434u0435u043e u0441 u043fu043eu043cu043eu0449u044cu044e Canvas
 * @param {HTMLVideoElement} video - u0418u0441u0445u043eu0434u043du043eu0435 u0432u0438u0434u0435u043e
 * @param {number} quality - u041au0430u0447u0435u0441u0442u0432u043e u0441u0436u0430u0442u0438u044f (0-1)
 * @param {number} scale - u041cu0430u0441u0448u0442u0430u0431 u0440u0430u0437u043cu0435u0440u0430 (0-1)
 */
function createOptimizedVideo(video, quality = 0.7, scale = 0.8) {
  // u042du0442u0430 u0444u0443u043du043au0446u0438u044f u0442u0440u0435u0431u0443u0435u0442 u0431u0438u0431u043bu0438u043eu0442u0435u043au0443 u0434u043bu044f u0441u0436u0430u0442u0438u044f u0432u0438u0434u0435u043e
  // u0412 u0434u0430u043du043du043eu043c u0441u043bu0443u0447u0430u0435 u043cu044b u043du0435 u0438u043cu043fu043bu0435u043cu0435u043du0442u0438u0440u0443u0435u043c u043fu043eu043bu043du043eu0435 u0441u0436u0430u0442u0438u0435 u0432u0438u0434u0435u043e u0432 u0431u0440u0430u0443u0437u0435u0440u0435,
  // u0442u0430u043a u043au0430u043a u044du0442u043e u0442u0440u0435u0431u0443u0435u0442 u0434u043eu043fu043eu043bu043du0438u0442u0435u043bu044cu043du044bu0445 u0431u0438u0431u043bu0438u043eu0442u0435u043a u0438 u0440u0435u0441u0443u0440u0441u043eu0432
  console.log('u0421u043eu0437u0434u0430u043du0438u0435 u043eu043fu0442u0438u043cu0438u0437u0438u0440u043eu0432u0430u043du043du043eu0439 u0432u0435u0440u0441u0438u0438 u0432u0438u0434u0435u043e u0442u0440u0435u0431u0443u0435u0442 u0434u043eu043fu043eu043bu043du0438u0442u0435u043bu044cu043du044bu0445 u0431u0438u0431u043bu0438u043eu0442u0435u043a');
}

// u0414u043eu0431u0430u0432u043bu044fu0435u043c u043eu0431u0440u0430u0431u043eu0442u0447u0438u043a u0434u043bu044f u043eu0442u043bu043eu0436u0435u043du043du043eu0439 u0437u0430u0433u0440u0443u0437u043au0438 u0432u0438u0434u0435u043e
window.addEventListener('load', function() {
  // u0417u0430u0434u0435u0440u0436u043au0430 u043fu0435u0440u0435u0434 u0437u0430u0433u0440u0443u0437u043au043eu0439 u0434u0440u0443u0433u0438u0445 u0432u0438u0434u0435u043e
  setTimeout(() => {
    const otherVideos = document.querySelectorAll('video:not(#start-bg)');
    otherVideos.forEach(video => {
      // u0417u0430u0433u0440u0443u0436u0430u0435u043c u0434u0440u0443u0433u0438u0435 u0432u0438u0434u0435u043e u0442u043eu043bu044cu043au043e u043fu043eu0441u043bu0435 u0437u0430u0433u0440u0443u0437u043au0438 u043eu0441u043du043eu0432u043du043eu0433u043e u0441u043eu0434u0435u0440u0436u0438u043cu043eu0433u043e
      video.setAttribute('preload', 'metadata');
    });
  }, 2000);
});
